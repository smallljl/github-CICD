server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    location = /index.html {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
        try_files $uri =404;
    }

    location / {
        try_files $uri $uri/ /index.html;
    }

    # GitHub Webhook 代理配置
    location /webhook/github {
        # 关闭请求缓冲，确保实时转发（适用于 webhook 流式数据）
        proxy_request_buffering off;
        # 关闭响应缓冲，立即转发响应数据
        proxy_buffering off;

        # 将请求代理转发到后端 webhook 服务
        proxy_pass http://webhook-host:9000/webhook/github;
        # 保留原始 Host 请求头
        proxy_set_header Host $host;
        # 传递客户端真实 IP 地址
        proxy_set_header X-Real-IP $remote_addr;
        # 传递完整的代理转发链（用于追踪真实客户端 IP）
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        # 传递原始请求协议（http/https）
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
